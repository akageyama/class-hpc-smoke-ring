<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
   
   <meta name="description" content="1次元バーガース方程式のシミュレーション + 可視化">
    
    <meta name="author" content="" >
    <link rel="icon" href="../favicon.png">

    <title>main.f90 &ndash; Burgers Equation</title>

    <link href="../css/bootstrap.min.css" rel="stylesheet">
    <link href="../css/pygments.css" rel="stylesheet">
    <link href="../css/font-awesome.min.css" rel="stylesheet">
    <link href="../css/local.css" rel="stylesheet">
    
    <link  href="../tipuesearch/tipuesearch.css" rel="stylesheet">
    
    

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    
    <script src="../js/jquery-2.1.3.min.js"></script>
    <script src="../js/svg-pan-zoom.min.js"></script>

  </head>

  <body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="../index.html">Burgers Equation </a>
        </div>
        <div id="navbar" class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
        
            <li class="dropdown hidden-xs visible-sm visible-md hidden-lg">
              <a href="#" class="dropdown-toggle"
              data-toggle="dropdown" role="button"
              aria-haspopup="true"
     aria-expanded="false">Contents <span class="caret"></span></a>
        <ul class="dropdown-menu">
          
              
            <li><a href="../lists/files.html">Source Files</a></li>
        
        
        
            <li><a href="../lists/modules.html">Modules</a></li>
        
            
                                
            <li><a href="../lists/procedures.html">Procedures</a></li>
        
               
        
            <li><a href="../program/main.html">Program</a></li>
      
            </ul>
            </li>


<li class="visible-xs hidden-sm visible-lg"><a href="../lists/files.html">Source Files</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/modules.html">Modules</a></li>



<li class="visible-xs hidden-sm visible-lg"><a href="../lists/procedures.html">Procedures</a></li>

                             

<li class="visible-xs hidden-sm visible-lg"><a href="../program/main.html">Program</a></li>

          </ul>
        
        <form action="../search.html" class="navbar-form navbar-right" role="search">
        <div class="form-group">
          <input type="text" class="form-control" placeholder="Search" name="q" id="tipue_search_input" autocomplete="off" required>
        </div>
<!--
        <button type="submit" class="btn btn-default">Submit</button>
-->
        </form>
        
        </div><!--/.nav-collapse -->
      </div>
    </nav>

    <div class="container">
    
  
  <div class="row">
    <h1>main.f90
    <small>Source File</small>
    
    </h1>
    
<div class="row">
  <div class="col-lg-12">
<div class="well well-sm">
  <ul class="list-inline" style="margin-bottom:0px;display:inline">
     
     
     
     
    
    
     <li><i class="fa fa-list-ol"></i>
       <a data-toggle="tooltip"
    data-placement="bottom" data-html="true"
    title="27.1% of total for source files.">74 statements</a>
     </li> 
     
     
     
    <li><i class="fa fa-code"></i><a href="../src/main.f90"> Source File</a></li>
     
     
  </ul>
  <ol class="breadcrumb in-well text-right">
  
    
  
     <li class="active">main.f90</li>
  </ol>
</div>
</div>
</div>
<script>
  $(function () {
  $('[data-toggle="tooltip"]').tooltip()
  })
</script>

  </div>
  <div class="row">
    <div class="col-md-3 hidden-xs hidden-sm visible-md visible-lg">
    
<div id="sidebar">
  
<h3>Contents</h3>
 






<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#progs-0">Programs</a></h3></div>
  <div id="progs-0" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../program/main.html">main</a>
      
    </div>
  </div>
</div>

















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/main.f90.html#src">main.f90</a>
  </div>
</div>



</div>

    </div>
    <div class="col-md-9" id='text'>
      <hr>
      <br>
    
    <div class="panel panel-default">
      <div class="panel-heading">
  <h3 class="panel-title">This file depends on</h3>
      </div>
      <div class="panel-body">
  <div class="depgraph"><?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: sourcefile~~main.f90~~EfferentGraph Pages: 1 -->
<svg id="sourcefilemainf90EfferentGraph" width="457pt" height="130pt"
 viewBox="0.00 0.00 457.07 129.84" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="sourcefile~~main.f90~~EfferentGraph" class="graph" transform="scale(1 1) rotate(0) translate(4 125.84)">
<title>sourcefile~~main.f90~~EfferentGraph</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-125.84 453.07,-125.84 453.07,4 -4,4"/>
<!-- sourcefile~main.f90 -->
<g id="sourcefile~~main.f90~~EfferentGraph_node1" class="node">
<title>sourcefile~main.f90</title>
<polygon fill="none" stroke="black" points="449.07,-69.21 395.07,-69.21 395.07,-47.2 449.07,-47.2 449.07,-69.21"/>
<text text-anchor="middle" x="422.07" y="-55.06" font-family="Helvetica,sans-Serif" font-size="10.50">main.f90</text>
</g>
<!-- sourcefile~namelist.f90 -->
<g id="sourcefile~~main.f90~~EfferentGraph_node2" class="node">
<title>sourcefile~namelist.f90</title>
<g id="a_sourcefile~~main.f90~~EfferentGraph_node2"><a xlink:href=".././sourcefile/namelist.f90.html" xlink:title="namelist.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="268.88,-89.21 200.65,-89.21 200.65,-67.2 268.88,-67.2 268.88,-89.21"/>
<text text-anchor="middle" x="234.76" y="-75.06" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">namelist.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~namelist.f90 -->
<g id="sourcefile~~main.f90~~EfferentGraph_edge1" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~namelist.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M331.07,-78.21C314.2,-80.06 295.56,-80.43 279.26,-80.2"/>
<polygon fill="#ff0000" stroke="#ff0000" points="279.01,-76.7 268.94,-79.98 278.86,-83.7 279.01,-76.7"/>
</g>
<!-- sourcefile~ut.f90 -->
<g id="sourcefile~~main.f90~~EfferentGraph_node3" class="node">
<title>sourcefile~ut.f90</title>
<g id="a_sourcefile~~main.f90~~EfferentGraph_node3"><a xlink:href=".././sourcefile/ut.f90.html" xlink:title="ut.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="164.46,-51.21 110.46,-51.21 110.46,-29.2 164.46,-29.2 164.46,-51.21"/>
<text text-anchor="middle" x="137.46" y="-37.06" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">ut.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~ut.f90 -->
<g id="sourcefile~~main.f90~~EfferentGraph_edge2" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~ut.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M331.07,-78.21C302.29,-81.37 297.3,-64.65 269.07,-58.21 237.69,-51.04 201.37,-46.32 175.01,-43.51"/>
<polygon fill="#ff0000" stroke="#ff0000" points="175.02,-40 164.72,-42.46 174.31,-46.96 175.02,-40"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M394.73,-65.53C377.36,-70.02 354.04,-75.43 333.07,-78.21"/>
</g>
<!-- sourcefile~constants.f90 -->
<g id="sourcefile~~main.f90~~EfferentGraph_node4" class="node">
<title>sourcefile~constants.f90</title>
<g id="a_sourcefile~~main.f90~~EfferentGraph_node4"><a xlink:href=".././sourcefile/constants.f90.html" xlink:title="constants.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="74.69,-51.21 -0.23,-51.21 -0.23,-29.2 74.69,-29.2 74.69,-51.21"/>
<text text-anchor="middle" x="37.23" y="-37.06" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">constants.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~constants.f90 -->
<g id="sourcefile~~main.f90~~EfferentGraph_edge3" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~constants.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M331.07,-78.21C302.36,-82.01 297.27,-91.66 269.07,-98.21 211.93,-111.48 195.59,-130.5 138.46,-117.21"/>
</g>
<!-- sourcefile~rk4.f90 -->
<g id="sourcefile~~main.f90~~EfferentGraph_node5" class="node">
<title>sourcefile~rk4.f90</title>
<g id="a_sourcefile~~main.f90~~EfferentGraph_node5"><a xlink:href=".././sourcefile/rk4.f90.html" xlink:title="rk4.f90">
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="359.07,-50.21 305.07,-50.21 305.07,-28.2 359.07,-28.2 359.07,-50.21"/>
<text text-anchor="middle" x="332.07" y="-36.06" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">rk4.f90</text>
</a>
</g>
</g>
<!-- sourcefile~main.f90&#45;&gt;sourcefile~rk4.f90 -->
<g id="sourcefile~~main.f90~~EfferentGraph_edge4" class="edge">
<title>sourcefile~main.f90&#45;&gt;sourcefile~rk4.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M394.67,-52.51C386.59,-50.76 377.56,-48.81 368.96,-46.96"/>
<polygon fill="#ff0000" stroke="#ff0000" points="369.66,-43.53 359.15,-44.84 368.19,-50.37 369.66,-43.53"/>
</g>
<!-- sourcefile~namelist.f90&#45;&gt;sourcefile~ut.f90 -->
<g id="sourcefile~~main.f90~~EfferentGraph_edge5" class="edge">
<title>sourcefile~namelist.f90&#45;&gt;sourcefile~ut.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M205.94,-67.11C195.93,-63.12 184.5,-58.56 173.92,-54.35"/>
<polygon fill="#ff0000" stroke="#ff0000" points="175.1,-51.05 164.52,-50.6 172.51,-57.55 175.1,-51.05"/>
</g>
<!-- sourcefile~namelist.f90&#45;&gt;sourcefile~constants.f90 -->
<g id="sourcefile~~main.f90~~EfferentGraph_edge6" class="edge">
<title>sourcefile~namelist.f90&#45;&gt;sourcefile~constants.f90</title>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M136.46,-117.21C101.55,-109.08 70.75,-79.32 53.32,-59.27"/>
<polygon fill="#ff0000" stroke="#ff0000" points="55.8,-56.78 46.69,-51.36 50.43,-61.27 55.8,-56.78"/>
<path fill="none" stroke="#ff0000" stroke-dasharray="5,2" d="M220.64,-89.34C202.66,-103.23 169.1,-124.34 138.46,-117.21"/>
</g>
<!-- sourcefile~ut.f90&#45;&gt;sourcefile~constants.f90 -->
<g id="sourcefile~~main.f90~~EfferentGraph_edge7" class="edge">
<title>sourcefile~ut.f90&#45;&gt;sourcefile~constants.f90</title>
<path fill="none" stroke="#7fff00" stroke-dasharray="5,2" d="M110.39,-40.21C102.55,-40.21 93.69,-40.21 84.93,-40.21"/>
<polygon fill="#7fff00" stroke="#7fff00" points="84.77,-36.71 74.77,-40.21 84.77,-43.71 84.77,-36.71"/>
</g>
<!-- sourcefile~rk4.f90&#45;&gt;sourcefile~namelist.f90 -->
<g id="sourcefile~~main.f90~~EfferentGraph_edge8" class="edge">
<title>sourcefile~rk4.f90&#45;&gt;sourcefile~namelist.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M305.03,-49.86C294.88,-54.02 283.08,-58.85 272.12,-63.33"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="270.7,-60.13 262.77,-67.16 273.35,-66.61 270.7,-60.13"/>
</g>
<!-- sourcefile~rk4.f90&#45;&gt;sourcefile~ut.f90 -->
<g id="sourcefile~~main.f90~~EfferentGraph_edge9" class="edge">
<title>sourcefile~rk4.f90&#45;&gt;sourcefile~ut.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M233.76,-1.21C207.74,1.07 180.38,-11.95 161.69,-23.56"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="159.71,-20.67 153.25,-29.06 163.53,-26.53 159.71,-20.67"/>
</g>
<!-- sourcefile~rk4.f90&#45;&gt;sourcefile~constants.f90 -->
<g id="sourcefile~~main.f90~~EfferentGraph_edge10" class="edge">
<title>sourcefile~rk4.f90&#45;&gt;sourcefile~constants.f90</title>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M312.54,-28.04C293.91,-17.74 263.98,-3.68 235.76,-1.21"/>
<path fill="none" stroke="#7f00ff" stroke-dasharray="5,2" d="M233.76,-1.21C178.57,3.62 115.95,-12.84 76.77,-25.85"/>
<polygon fill="#7f00ff" stroke="#7f00ff" points="75.43,-22.61 67.09,-29.15 77.69,-29.23 75.43,-22.61"/>
</g>
</g>
</svg>
</div><div><a type="button" class="graph-help" data-toggle="modal" href="#graph-help-text">Help</a></div><div class="modal fade" id="graph-help-text" tabindex="-1" role="dialog"><div class="modal-dialog modal-lg" role="document"><div class="modal-content"><div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button><h4 class="modal-title" id="-graph-help-label">Graph Key</h4></div><div class="modal-body">
    <p>Nodes of different colours represent the following: </p>
    <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN"
 "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<!-- Generated by graphviz version 2.43.0 (0)
 -->
<!-- Title: Graph Key Pages: 1 -->
<svg width="186pt" height="31pt"
 viewBox="0.00 0.00 186.41 30.50" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
<g id="graph0" class="graph" transform="scale(1 1) rotate(0) translate(4 26.5)">
<title>Graph Key</title>
<polygon fill="white" stroke="transparent" points="-4,4 -4,-26.5 182.41,-26.5 182.41,4 -4,4"/>
<!-- Source File -->
<g id="node1" class="node">
<title>Source File</title>
<polygon fill="#f0ad4e" stroke="#f0ad4e" points="65.16,-22.26 -0.05,-22.26 -0.05,-0.24 65.16,-0.24 65.16,-22.26"/>
<text text-anchor="middle" x="32.55" y="-8.1" font-family="Helvetica,sans-Serif" font-size="10.50" fill="white">Source File</text>
</g>
<!-- This Page&#39;s Entity -->
<g id="node2" class="node">
<title>This Page&#39;s Entity</title>
<polygon fill="none" stroke="black" points="178.26,-22.26 82.84,-22.26 82.84,-0.24 178.26,-0.24 178.26,-22.26"/>
<text text-anchor="middle" x="130.55" y="-8.1" font-family="Helvetica,sans-Serif" font-size="10.50">This Page&#39;s Entity</text>
</g>
</g>
</svg>

    
    <p>Solid arrows point from a file to a file which it depends on. A file
    is dependent upon another if the latter must be compiled before the former
    can be. Where possible, edges connecting nodes are given different colours to make them easier to distinguish in large graphs.
    </p>
    </div></div></div></div>
      </div>
    </div>
    
      
      <br>

    <section class="visible-xs visible-sm hidden-md">
      
<h3>Contents</h3>
 






<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title"><a data-toggle="collapse" href="#progs-1">Programs</a></h3></div>
  <div id="progs-1" class="panel-collapse collapse">
    <div class="list-group">
      
      <a class="list-group-item" href="../program/main.html">main</a>
      
    </div>
  </div>
</div>

















<div class="panel panel-primary">
  <div class="panel-heading text-left"><h3 class="panel-title">Source Code</h3></div>
  <div class="list-group">
    <a class="list-group-item" href="../sourcefile/main.f90.html#src">main.f90</a>
  </div>
</div>



    </section>
    <br class="visible-xs visible-sm hidden-md">

    <section>
      <h2><span class="anchor" id="src"></span>Source Code</h2>
    <div class="hl"><pre><span></span><a name="ln-1"></a><span class="c">!*******************************************************************</span>
<a name="ln-2"></a><span class="c">!&gt; author: Akira Kageyama</span>
<a name="ln-3"></a><span class="c">!  date: 2020.01.15</span>
<a name="ln-4"></a><span class="c">!</span>
<a name="ln-5"></a><span class="c">!  バーガース方程式を差分法+ルンゲ・クッタ積分法で解き、可視化する。</span>
<a name="ln-6"></a><span class="c">!</span>
<a name="ln-7"></a><span class="c">!  神戸大学情報知能工学科の講義 &quot;HPC&quot; （B3対象）用サンプルコード</span>
<a name="ln-8"></a><span class="c">! </span>
<a name="ln-9"></a><span class="c">!### 目的</span>
<a name="ln-10"></a><span class="c">!  この後に説明する3次元Smoke-Ringシミュレーションコードを理解するため。</span>
<a name="ln-11"></a><span class="c">!</span>
<a name="ln-12"></a><span class="c">!  3次元Smoke-Ringシミュレーションコードでは</span>
<a name="ln-13"></a><span class="c">!  基本方程式は違うものの、アルゴリズム（差分法+ルンゲ・クッタ積分法）</span>
<a name="ln-14"></a><span class="c">!  とシミュレーションコードの構造が同じである。</span>
<a name="ln-15"></a><span class="c">! </span>
<a name="ln-16"></a><span class="c">!### 実行方法</span>
<a name="ln-17"></a><span class="c">!  cd src ; make      </span>
<a name="ln-18"></a><span class="c">!     </span>
<a name="ln-19"></a>
<a name="ln-20"></a><span class="k">program </span><span class="n">main</span>
<a name="ln-21"></a>  <span class="k">use </span><span class="n">constants_m</span>  <span class="c">! 定数の読み込み</span>
<a name="ln-22"></a>  <span class="k">use </span><span class="n">ut_m</span>         <span class="c">! ユーティリティライブラリ</span>
<a name="ln-23"></a>  <span class="k">use </span><span class="n">namelist_m</span>   <span class="c">! namelist機能を使ったパラメータ読み込み</span>
<a name="ln-24"></a>  <span class="k">use </span><span class="n">rk4_m</span>        <span class="c">! Runge-Kutta積分法</span>
<a name="ln-25"></a>  <span class="k">implicit none</span>
<a name="ln-26"></a>
<a name="ln-27"></a><span class="k">  </span><span class="kt">real</span><span class="p">(</span><span class="n">DR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">xpos</span>
<a name="ln-28"></a>           <span class="c">! 格子点の位置（x座標）の配列  配列サイズはnx</span>
<a name="ln-29"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">DR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">psi</span>
<a name="ln-30"></a>           <span class="c">! 求める振幅の配列   配列サイズはnx</span>
<a name="ln-31"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">DR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(:),</span> <span class="k">allocatable</span> <span class="kd">::</span> <span class="n">dpsi01</span><span class="p">,</span> <span class="n">dpsi02</span><span class="p">,</span>  <span class="p">&amp;</span>
<a name="ln-32"></a>                                         <span class="n">dpsi03</span><span class="p">,</span> <span class="n">dpsi04</span>
<a name="ln-33"></a>           <span class="c">! 4段のRunge-Kutta法に必要となる4つの作業用配列</span>
<a name="ln-34"></a>           <span class="c">! 1段の作業での被積分関数（振幅psi）の微小な増分量に相当</span>
<a name="ln-35"></a>  <span class="kt">integer</span><span class="p">(</span><span class="n">SI</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span><span class="p">,</span> <span class="n">nx</span>
<a name="ln-36"></a>  <span class="kt">integer</span><span class="p">(</span><span class="n">DI</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nloop</span>             <span class="c">! 時間積分の回数</span>
<a name="ln-37"></a>  <span class="kt">integer</span><span class="p">(</span><span class="n">DI</span><span class="p">)</span> <span class="kd">::</span> <span class="n">nloop_max</span> <span class="o">=</span> <span class="mi">1000</span>  <span class="c">! 一度の計算ジョブでの積分回数最大値</span>
<a name="ln-38"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">DR</span><span class="p">)</span> <span class="kd">::</span> <span class="n">dx</span><span class="p">,</span> <span class="n">dt</span><span class="p">,</span> <span class="nb">time</span><span class="p">,</span> <span class="n">x</span>      <span class="c">! 格子間隔、時間刻み、時刻、x座標</span>
<a name="ln-39"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">DR</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">ONE_SIXTH</span> <span class="o">=</span> <span class="mf">1.0_DR</span> <span class="o">/</span> <span class="mf">6.0_DR</span>
<a name="ln-40"></a>                         <span class="c">! Runge-Kutta法で必要となる定数</span>
<a name="ln-41"></a>                         <span class="c">! 毎回この割り算をするのは演算の</span>
<a name="ln-42"></a>                         <span class="c">! 無駄なのでこうして定数として保存する</span>
<a name="ln-43"></a>  <span class="kt">real</span><span class="p">(</span><span class="n">DR</span><span class="p">),</span> <span class="k">parameter</span> <span class="kd">::</span> <span class="n">CFL_FACTOR</span> <span class="o">=</span> <span class="mf">0.4_DR</span>
<a name="ln-44"></a>                         <span class="c">! 時間発展を追跡する計算機シミュレーションでは</span>
<a name="ln-45"></a>                         <span class="c">! 一般に、時間刻み幅dtが小さいと、効率が悪い。</span>
<a name="ln-46"></a>                         <span class="c">! 実時間で同じ時刻に到達するまでに必要となる</span>
<a name="ln-47"></a>                         <span class="c">! 積分回数が多くなるからである。</span>
<a name="ln-48"></a>
<a name="ln-49"></a>                         <span class="c">! だが、ここで採用しているRunge-Kutta法のような</span>
<a name="ln-50"></a>                         <span class="c">! 陽的な時間積分アルゴリズムではdtを大きく</span>
<a name="ln-51"></a>                         <span class="c">! しすぎると計算が破綻（発散）する。</span>
<a name="ln-52"></a>                         <span class="c">!</span>
<a name="ln-53"></a>                         <span class="c">! その発散条件をCFL (Courant-Friedrichs-Lewy)条件</span>
<a name="ln-54"></a>                         <span class="c">! という。</span>
<a name="ln-55"></a>                         <span class="c">!</span>
<a name="ln-56"></a>                         <span class="c">! CFL条件はある定数の比例するという形で書ける</span>
<a name="ln-57"></a>                         <span class="c">! 場合が多い。その定数をCFL_FACTORという。</span>
<a name="ln-58"></a>                         <span class="c">!</span>
<a name="ln-59"></a>                         <span class="c">! CFL_FACTORは、</span>
<a name="ln-60"></a>                         <span class="c">!   (1) アルゴリズム（ここでは二次精度空間</span>
<a name="ln-61"></a>                         <span class="c">!       中心差分法と4次精度Runge-Kutta時間積分</span>
<a name="ln-62"></a>                         <span class="c">!       の組み合わせ）</span>
<a name="ln-63"></a>                         <span class="c">!   (2) 基本方程式（ここではバーガース方程式）</span>
<a name="ln-64"></a>                         <span class="c">!   (3) 方程式のパラメータ（ここではバーガース</span>
<a name="ln-65"></a>                         <span class="c">!       方程式に含まれる粘性係数）</span>
<a name="ln-66"></a>                         <span class="c">! で決まり、その値を理論的、または数値的に</span>
<a name="ln-67"></a>                         <span class="c">! 高精度で求めることが原理的には可能である。</span>
<a name="ln-68"></a>                         <span class="c">! </span>
<a name="ln-69"></a>                         <span class="c">! しかしながら、CFL_FACTORを高精度で求めること</span>
<a name="ln-70"></a>                         <span class="c">! は実際上、余り意味がない。（その値をたとえば</span>
<a name="ln-71"></a>                         <span class="c">! 0.4から0.45にしてもシミュレーションの進行</span>
<a name="ln-72"></a>                         <span class="c">! 速度が(45/4)倍になるだけである。）</span>
<a name="ln-73"></a>                         <span class="c">! </span>
<a name="ln-74"></a>                         <span class="c">! ここでは半経験的にこのCFL_FACTORを設定した。</span>
<a name="ln-75"></a>                         <span class="c">!</span>
<a name="ln-76"></a>                         <span class="c">! 対象方程式（バーガース方程式）やアルゴリズム</span>
<a name="ln-77"></a>                         <span class="c">! を変更したらこの値も調整する必要がある。</span>
<a name="ln-78"></a>
<a name="ln-79"></a>  <span class="c">!</span>
<a name="ln-80"></a>  <span class="c">!    1    2    3    4                                    nx-1  nx</span>
<a name="ln-81"></a>  <span class="c">!    !----!----!----!----!----!--             --!----!----!----!</span>
<a name="ln-82"></a>  <span class="c">!         !               \  /                                 !</span>
<a name="ln-83"></a>  <span class="c">!         !                dx = TWOPI / (nx-2)                 !</span>
<a name="ln-84"></a>  <span class="c">!    x=-PI!&lt;---------------------- TWOPI ---------------------&gt;!x=+PI</span>
<a name="ln-85"></a>  <span class="c">!         !                                                    !</span>
<a name="ln-86"></a>  <span class="c">!         !                                                    !</span>
<a name="ln-87"></a>  <span class="c">!  --!----!                                                !---!--</span>
<a name="ln-88"></a>  <span class="c">!  nx-1  nx                                                1   2</span>
<a name="ln-89"></a>  <span class="c">!</span>
<a name="ln-90"></a>  <span class="c">! 格子点とその番号割当の模式図</span>
<a name="ln-91"></a>  <span class="c">!   * 格子番号は1で始まり、nxまで。</span>
<a name="ln-92"></a>  <span class="c">!   * 周期境界条件を仮定している。周期の長さは2*pi</span>
<a name="ln-93"></a>  <span class="c">!   * 2番の格子点とnx番の格子点が実際は同じ空間位置を指す。</span>
<a name="ln-94"></a>  <span class="c">!   * 同様に1番の格子点と(nx-1)番の格子点が同じ空間位置を指す。</span>
<a name="ln-95"></a>
<a name="ln-96"></a>  <span class="k">call </span><span class="n">namelist__read</span>
<a name="ln-97"></a>     <span class="c">! Fortranのnamelistという機能を使って</span>
<a name="ln-98"></a>     <span class="c">! シミュレーションの数値パラメータを読み込む。</span>
<a name="ln-99"></a>     <span class="c">! ここで読み込むパラメータは2つ</span>
<a name="ln-100"></a>     <span class="c">!  (1) Nx : 格子間隔</span>
<a name="ln-101"></a>     <span class="c">!  (2) Diffusion_coeff : 粘性率に相当する拡散係数</span>
<a name="ln-102"></a>     <span class="c">! </span>
<a name="ln-103"></a>     <span class="c">! この程度であればわざわざnamelistを使わなくてもいいが、</span>
<a name="ln-104"></a>     <span class="c">! もっと大規模なシミュレーションになると多数の入力パラメータ</span>
<a name="ln-105"></a>     <span class="c">! が必要になる。</span>
<a name="ln-106"></a>     <span class="c">! </span>
<a name="ln-107"></a>     <span class="c">! 定数を設定するconstantsモジュールに直接パラメータを</span>
<a name="ln-108"></a>     <span class="c">! 書き込むのは得策ではない。なぜならばパラメーターを</span>
<a name="ln-109"></a>     <span class="c">! 変更するたびに毎回コンパイルする必要が生じるからである。</span>
<a name="ln-110"></a>     <span class="c">! </span>
<a name="ln-111"></a>     <span class="c">! 入力パラメーターは人間にとって読み書きのしやすい</span>
<a name="ln-112"></a>     <span class="c">! テキストデータで渡すべきである。</span>
<a name="ln-113"></a>     <span class="c">! </span>
<a name="ln-114"></a>     <span class="c">! テキストデータをプログラムに渡す時にはパラメーターの</span>
<a name="ln-115"></a>     <span class="c">! 名前とその値のペアをわかりやすい形で表現できるのが望ましい。</span>
<a name="ln-116"></a>     <span class="c">!</span>
<a name="ln-117"></a>     <span class="c">! その仕組みがnamelistである。</span>
<a name="ln-118"></a>     <span class="c">! </span>
<a name="ln-119"></a>
<a name="ln-120"></a>  <span class="n">nx</span> <span class="o">=</span> <span class="n">namelist__get_integer</span><span class="p">(</span><span class="s1">&#39;Nx&#39;</span><span class="p">)</span>  <span class="c">! 文字列をキーにして値を取り出す</span>
<a name="ln-121"></a>  <span class="n">dx</span> <span class="o">=</span> <span class="n">TWOPI</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>               <span class="c">! 格子間隔。上の図を見よ。</span>
<a name="ln-122"></a>  <span class="n">dt</span> <span class="o">=</span> <span class="n">dx</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="n">namelist__get_double</span><span class="p">(</span><span class="s1">&#39;Diffusion_coeff&#39;</span><span class="p">)</span> <span class="o">*</span> <span class="n">CFL_FACTOR</span>
<a name="ln-123"></a>                                    <span class="c">! CFL条件</span>
<a name="ln-124"></a>
<a name="ln-125"></a>  <span class="k">allocate</span><span class="p">(</span><span class="n">xpos</span><span class="p">(</span><span class="n">nx</span><span class="p">),</span><span class="n">psi</span><span class="p">(</span><span class="n">nx</span><span class="p">))</span>   <span class="c">! 配列の割当</span>
<a name="ln-126"></a>  <span class="k">allocate</span><span class="p">(</span><span class="n">dpsi01</span><span class="p">(</span><span class="n">nx</span><span class="p">))</span>
<a name="ln-127"></a>  <span class="k">allocate</span><span class="p">(</span><span class="n">dpsi02</span><span class="p">(</span><span class="n">nx</span><span class="p">))</span>
<a name="ln-128"></a>  <span class="k">allocate</span><span class="p">(</span><span class="n">dpsi03</span><span class="p">(</span><span class="n">nx</span><span class="p">))</span>
<a name="ln-129"></a>  <span class="k">allocate</span><span class="p">(</span><span class="n">dpsi04</span><span class="p">(</span><span class="n">nx</span><span class="p">))</span>
<a name="ln-130"></a>
<a name="ln-131"></a>  <span class="n">xpos</span><span class="p">(:)</span> <span class="o">=</span> <span class="mf">0.0_DR</span>    <span class="c">! ゼロで初期化。allocate後の配列の値は</span>
<a name="ln-132"></a>  <span class="n">psi</span><span class="p">(:)</span>  <span class="o">=</span> <span class="mf">0.0_DR</span>    <span class="c">! ゼロになっているとは限らないので注意。</span>
<a name="ln-133"></a>  <span class="n">dpsi01</span><span class="p">(:)</span> <span class="o">=</span> <span class="mf">0.0_DR</span>  <span class="c">! 配列の初期化忘れに起因する混乱（ゼロ</span>
<a name="ln-134"></a>  <span class="n">dpsi02</span><span class="p">(:)</span> <span class="o">=</span> <span class="mf">0.0_DR</span>  <span class="c">! だと思って計算した配列に実は非ゼロの</span>
<a name="ln-135"></a>  <span class="n">dpsi03</span><span class="p">(:)</span> <span class="o">=</span> <span class="mf">0.0_DR</span>  <span class="c">! ランダムな値が入っていて計算がおかしく</span>
<a name="ln-136"></a>  <span class="n">dpsi04</span><span class="p">(:)</span> <span class="o">=</span> <span class="mf">0.0_DR</span>  <span class="c">! なること）はシミュレーションではよくある。</span>
<a name="ln-137"></a>
<a name="ln-138"></a>  <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">nx</span>
<a name="ln-139"></a>    <span class="n">xpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="n">PI</span> <span class="o">+</span> <span class="n">dx</span><span class="o">*</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>  <span class="c">! 格子点位置の設定。上の図を参照せよ。</span>
<a name="ln-140"></a>  <span class="k">end do</span>
<a name="ln-141"></a>
<a name="ln-142"></a><span class="k">  do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">nx</span>
<a name="ln-143"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">xpos</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
<a name="ln-144"></a>    <span class="n">psi</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="mf">0.8_DR</span> <span class="o">+</span> <span class="mf">0.2_DR</span><span class="o">*</span><span class="nb">cos</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>  <span class="c">! 初期振幅。自由に設定してよい。</span>
<a name="ln-145"></a>  <span class="k">end do</span>
<a name="ln-146"></a>    <span class="c">! バーガース方程式の性質から振幅の大きい（つまりpsiの値が</span>
<a name="ln-147"></a>    <span class="c">! 大きい）ところほど移流速度が速い。そのため波の「突っ立ち」</span>
<a name="ln-148"></a>    <span class="c">! 現象が生じる。</span>
<a name="ln-149"></a>    <span class="c">!</span>
<a name="ln-150"></a>    <span class="c">! 完全に垂直に突っ立った波は（勾配が無限になるので） </span>
<a name="ln-151"></a>    <span class="c">! 差分法では表現できないが、バーガース方程式に含まれる</span>
<a name="ln-152"></a>    <span class="c">! 粘性（拡散）項が急な勾配の発生を抑える。</span>
<a name="ln-153"></a>    <span class="c">!</span>
<a name="ln-154"></a>    <span class="c">! 粘性係数が大きすぎると波がすぐに拡散して消えてしまう。</span>
<a name="ln-155"></a>    <span class="c">! </span>
<a name="ln-156"></a>    <span class="c">! 粘性は小さい方が（突っ立ちが見えて）面白いが、小さすぎる</span>
<a name="ln-157"></a>    <span class="c">! と突っ立ちのために計算が発散してしまう。実験するとよい。</span>
<a name="ln-158"></a>    <span class="c">! （粘性係数はnamelistで渡している。params.namelistファイル。）</span>
<a name="ln-159"></a>    <span class="c">!</span>
<a name="ln-160"></a>    <span class="c">! できるだけ粘性を小さくするにはどうしたらよいか？</span>
<a name="ln-161"></a>    <span class="c">! 格子点数（nx）を大きくすれば良い。急な勾配であってもその</span>
<a name="ln-162"></a>    <span class="c">! 曲線の中に十分多くの格子点があれば差分が計算できるからである。</span>
<a name="ln-163"></a>    <span class="c">! これも実験するとよい。</span>
<a name="ln-164"></a>
<a name="ln-165"></a>  <span class="k">call </span><span class="n">ut__message</span><span class="p">(</span><span class="s1">&#39;initial check: nx = &#39;</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>
<a name="ln-166"></a>    <span class="c">! 標準出力に文字列と整数値を書き出す。</span>
<a name="ln-167"></a>    <span class="c">! このような出力はよく使うのでutモジュールに入れた。</span>
<a name="ln-168"></a>  <span class="k">call </span><span class="n">ut__message</span><span class="p">(</span><span class="s1">&#39;initial check: dx = &#39;</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
<a name="ln-169"></a>    <span class="c">! 同じサブルーチン名で呼び出しているが、こちらは倍精度浮動小数点数</span>
<a name="ln-170"></a>    <span class="c">! であるdxを書き出すことに注意。多重定義である。</span>
<a name="ln-171"></a>
<a name="ln-172"></a>  <span class="nb">time</span> <span class="o">=</span> <span class="mf">0.0_DR</span>  <span class="c">! シミュレーション時刻の設定</span>
<a name="ln-173"></a>
<a name="ln-174"></a>  <span class="k">call </span><span class="n">iSave</span> <span class="c">! 初期条件の振幅（psi）をディスクに書き出す。</span>
<a name="ln-175"></a>             <span class="c">! 小文字のiで始まるサブルーチン・関数は</span>
<a name="ln-176"></a>             <span class="c">! 内部副プログラム、という命名規約を使っている。</span>
<a name="ln-177"></a>             <span class="c">! つまり &quot;call iなんとか&quot; と書かれていたら、</span>
<a name="ln-178"></a>             <span class="c">! 呼び出されている &quot;iなんとか&quot; はそのすぐ下の</span>
<a name="ln-179"></a>             <span class="c">! contains文の後ろに定義があることが分かるので</span>
<a name="ln-180"></a>             <span class="c">! 見つけやすい。</span>
<a name="ln-181"></a>
<a name="ln-182"></a>  <span class="k">do </span><span class="n">nloop</span> <span class="o">=</span> <span class="mi">1</span> <span class="p">,</span> <span class="n">nloop_max</span>  <span class="c">! シミュレーションのメインループ</span>
<a name="ln-183"></a>    <span class="c">!--&lt; Runge-Kutta step 1 &gt;--!</span>
<a name="ln-184"></a>    <span class="n">dpsi01</span><span class="p">(:)</span> <span class="o">=</span> <span class="n">rk4__step</span><span class="p">(</span><span class="s1">&#39;1st&#39;</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">dx</span><span class="p">,</span><span class="n">psi</span><span class="p">)</span>  <span class="c">! ルンゲ・クッタ1段目</span>
<a name="ln-185"></a>    <span class="k">call </span><span class="n">iBoundary_condition</span><span class="p">(</span><span class="n">dpsi01</span><span class="p">)</span>        <span class="c">! 境界条件の設定</span>
<a name="ln-186"></a>                                            <span class="c">! 小文字のiで始まっ</span>
<a name="ln-187"></a>                                            <span class="c">! ているので、内部副</span>
<a name="ln-188"></a>                                            <span class="c">! プログラム、つまり</span>
<a name="ln-189"></a>                                            <span class="c">! 下のcontains文の</span>
<a name="ln-190"></a>                                            <span class="c">! 後で定義されている</span>
<a name="ln-191"></a>
<a name="ln-192"></a>    <span class="c">!--&lt; Runge-Kutta step 2 &gt;--!</span>
<a name="ln-193"></a>    <span class="n">dpsi02</span><span class="p">(:)</span> <span class="o">=</span> <span class="n">rk4__step</span><span class="p">(</span><span class="s1">&#39;2nd&#39;</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">dx</span><span class="p">,</span><span class="n">psi</span><span class="p">,</span><span class="n">dpsi01</span><span class="p">)</span>    <span class="c">! 2段目</span>
<a name="ln-194"></a>    <span class="k">call </span><span class="n">iBoundary_condition</span><span class="p">(</span><span class="n">dpsi02</span><span class="p">)</span>        <span class="c">! 境界条件の設定</span>
<a name="ln-195"></a>
<a name="ln-196"></a>    <span class="c">!--&lt; Runge-Kutta step 3 &gt;--!</span>
<a name="ln-197"></a>    <span class="n">dpsi03</span><span class="p">(:)</span> <span class="o">=</span> <span class="n">rk4__step</span><span class="p">(</span><span class="s1">&#39;3rd&#39;</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">dx</span><span class="p">,</span><span class="n">psi</span><span class="p">,</span><span class="n">dpsi02</span><span class="p">)</span>    <span class="c">! 3段目</span>
<a name="ln-198"></a>    <span class="k">call </span><span class="n">iBoundary_condition</span><span class="p">(</span><span class="n">dpsi03</span><span class="p">)</span>        <span class="c">! 境界条件の設定</span>
<a name="ln-199"></a>
<a name="ln-200"></a>    <span class="c">!--&lt; Runge-Kutta step 4 &gt;--!</span>
<a name="ln-201"></a>    <span class="n">dpsi04</span><span class="p">(:)</span> <span class="o">=</span> <span class="n">rk4__step</span><span class="p">(</span><span class="s1">&#39;4th&#39;</span><span class="p">,</span><span class="n">dt</span><span class="p">,</span><span class="n">dx</span><span class="p">,</span><span class="n">psi</span><span class="p">,</span><span class="n">dpsi03</span><span class="p">)</span>    <span class="c">! 4段目</span>
<a name="ln-202"></a>    <span class="k">call </span><span class="n">iBoundary_condition</span><span class="p">(</span><span class="n">dpsi04</span><span class="p">)</span>        <span class="c">! 境界条件の設定</span>
<a name="ln-203"></a>
<a name="ln-204"></a>    <span class="nb">time</span> <span class="o">=</span> <span class="nb">time</span> <span class="o">+</span> <span class="n">dt</span>  <span class="c">! 時間の更新</span>
<a name="ln-205"></a>                      <span class="c">! 【注意】バーガース方程式は時刻tに陽には</span>
<a name="ln-206"></a>                      <span class="c">!   依存しない（方程式にtが直接現れない）ので、</span>
<a name="ln-207"></a>                      <span class="c">!   このように4段の積分が終了した後にdtだけ</span>
<a name="ln-208"></a>                      <span class="c">!   時間を進めても問題ない。</span>
<a name="ln-209"></a>                      <span class="c">!   だが、もしも解くべき基本方程式が時刻tに陽に</span>
<a name="ln-210"></a>                      <span class="c">!   依存する場合には、4段の積分過程の途中で</span>
<a name="ln-211"></a>                      <span class="c">!   時刻をdt/2だけ進める必要がある。詳しくは</span>
<a name="ln-212"></a>                      <span class="c">!   ルンゲ・クッタのアルゴリズムを見よ。</span>
<a name="ln-213"></a>
<a name="ln-214"></a>    <span class="n">psi</span><span class="p">(:)</span> <span class="o">=</span> <span class="n">psi</span><span class="p">(:)</span> <span class="o">+</span> <span class="n">ONE_SIXTH</span><span class="o">*</span><span class="p">(</span><span class="n">dpsi01</span><span class="p">(:)</span>      <span class="p">&amp;</span>
<a name="ln-215"></a>                              <span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">dpsi02</span><span class="p">(:)</span>      <span class="p">&amp;</span>
<a name="ln-216"></a>                              <span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">dpsi03</span><span class="p">(:)</span>      <span class="p">&amp;</span>
<a name="ln-217"></a>                                <span class="o">+</span><span class="n">dpsi04</span><span class="p">(:))</span>
<a name="ln-218"></a>                      <span class="c">! ここでは教科書に載っている古典的な4段4次の</span>
<a name="ln-219"></a>                      <span class="c">! ルンゲ・クッタアルゴリズムをそのまま実装</span>
<a name="ln-220"></a>                      <span class="c">! している。この方法ではこのように作業配列（dpsi）</span>
<a name="ln-221"></a>                      <span class="c">! が4つ必要である。同じ4次のルンゲ・クッタ法でも</span>
<a name="ln-222"></a>                      <span class="c">! 作業配列を少なくするアルゴリズムがある。大規模</span>
<a name="ln-223"></a>                      <span class="c">! なシミュレーションなどでメモリを節約する必要が</span>
<a name="ln-224"></a>                      <span class="c">! ある場合は、それらの手法を使うべきである。</span>
<a name="ln-225"></a>
<a name="ln-226"></a>    <span class="k">if</span> <span class="p">(</span> <span class="nb">mod</span><span class="p">(</span><span class="n">nloop</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span><span class="o">==</span><span class="mi">0</span> <span class="p">)</span> <span class="k">then</span>
<a name="ln-227"></a><span class="k">      call </span><span class="n">iSave</span>  <span class="c">! Save the profile to the disk.</span>
<a name="ln-228"></a>         <span class="c">! gnuplotを使ったアニメーション表示のためにディスクに</span>
<a name="ln-229"></a>         <span class="c">! 振幅を書き出す。毎ステップ書き出すとディスク容量を</span>
<a name="ln-230"></a>         <span class="c">! 圧迫する割に視覚的な効果はそれほど向上しない。ここで</span>
<a name="ln-231"></a>         <span class="c">! は4ステップごとに書き出しているがこの数字は適当に決めた。</span>
<a name="ln-232"></a>         <span class="c">! 格子点数nxの値などを変更する場合はこの数字も調整が</span>
<a name="ln-233"></a>         <span class="c">! 必要であろう。</span>
<a name="ln-234"></a>    <span class="k">end if</span>
<a name="ln-235"></a><span class="k">  end do</span>
<a name="ln-236"></a>
<a name="ln-237"></a><span class="k">contains</span>
<a name="ln-238"></a>
<a name="ln-239"></a><span class="k">  subroutine </span><span class="n">iBoundary_condition</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>
<a name="ln-240"></a>    <span class="kt">real</span><span class="p">(</span><span class="n">DR</span><span class="p">),</span> <span class="k">dimension</span><span class="p">(</span><span class="n">nx</span><span class="p">),</span> <span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span> <span class="kd">::</span> <span class="n">psi</span>
<a name="ln-241"></a>    <span class="c">! 周期境界条件  上の説明用コメント図を参照せよ。</span>
<a name="ln-242"></a>    <span class="n">psi</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>    <span class="o">=</span> <span class="n">psi</span><span class="p">(</span><span class="n">nx</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
<a name="ln-243"></a>    <span class="n">psi</span><span class="p">(</span><span class="n">nx</span><span class="p">)</span>   <span class="o">=</span> <span class="n">psi</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<a name="ln-244"></a>  <span class="k">end subroutine </span><span class="n">iBoundary_condition</span>
<a name="ln-245"></a>
<a name="ln-246"></a>  <span class="k">subroutine </span><span class="n">iSave</span>
<a name="ln-247"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">SI</span><span class="p">),</span> <span class="k">save</span> <span class="kd">::</span> <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<a name="ln-248"></a>    <span class="kt">integer</span><span class="p">(</span><span class="n">SI</span><span class="p">)</span> <span class="kd">::</span> <span class="n">i</span>
<a name="ln-249"></a>    <span class="c">! ディスクへの書き出し</span>
<a name="ln-250"></a>    <span class="k">open</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="k">file</span><span class="o">=</span><span class="s2">&quot;output.data&quot;</span> <span class="o">//</span> <span class="s1">&#39;.&#39;</span> <span class="o">//</span> <span class="n">ut__i2c3</span><span class="p">(</span><span class="n">counter</span><span class="p">))</span>
<a name="ln-251"></a>      <span class="c">! ファイルオープン</span>
<a name="ln-252"></a>      <span class="c">! スラッシュ記号2つ連続は文字列連結演算子</span>
<a name="ln-253"></a>      <span class="c">! ut__i2c3はutモジュールで定義された整数（i）を3文字</span>
<a name="ln-254"></a>      <span class="c">! に変換する関数</span>
<a name="ln-255"></a>      <span class="k">do </span><span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="n">nx</span>
<a name="ln-256"></a>         <span class="k">write</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="o">*</span><span class="p">)</span> <span class="n">xpos</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">psi</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>  <span class="c">! gnuplotのフォーマット準拠</span>
<a name="ln-257"></a>                                      <span class="c">! つまりxの値とyの値を空白で区切る</span>
<a name="ln-258"></a>      <span class="k">end do</span>
<a name="ln-259"></a><span class="k">    close</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<a name="ln-260"></a>    <span class="n">counter</span> <span class="o">=</span> <span class="n">counter</span> <span class="o">+</span> <span class="mi">1</span>
<a name="ln-261"></a>    <span class="c">! ファイル名に整数連番を不可する。その数字のインクリメント</span>
<a name="ln-262"></a>    <span class="k">call </span><span class="n">ut__message</span><span class="p">(</span><span class="s2">&quot; Data saved at nloop, time = &quot;</span><span class="p">,</span> <span class="n">nloop</span><span class="p">,</span> <span class="nb">time</span><span class="p">)</span>
<a name="ln-263"></a>    <span class="c">! これも多重定義。文字列に整数、浮動小数点数をつなげて出力</span>
<a name="ln-264"></a>  <span class="k">end subroutine </span><span class="n">iSave</span>
<a name="ln-265"></a>
<a name="ln-266"></a><span class="k">end program </span><span class="n">main</span>
</pre></div>

    </section>
    </div>
  </div>

  
    <hr>    
    </div> <!-- /container -->
    <footer>
      <div class="container">
      <div class="row">
        <div class="col-xs-6 col-md-4"><p>&copy; 2020 
                                          </p></div>
        <div class="col-xs-6 col-md-4 col-md-push-4">
          <p class="text-right">
            Documentation generated by 
            <a href="https://github.com/cmacmackin/ford">FORD</a>
             on 2020-01-16 11:28  
          </p>
        </div>
        <div class="col-xs-12 col-md-4 col-md-pull-4"><p class="text-center"> Burgers Equation was developed by </p></div>
      </div>
      <br>
      </div> <!-- /container -->    
    </footer>

    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
<!--
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
-->
    <script src="../js/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../js/ie10-viewport-bug-workaround.js"></script>

    <!-- MathJax JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } },
        jax: ['input/TeX','input/MathML','output/HTML-CSS'],
        extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']
      });
    </script>
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    
    <script src="../tipuesearch/tipuesearch_content.js"></script>
    <script src="../tipuesearch/tipuesearch_set.js"></script>
    <script src="../tipuesearch/tipuesearch.js"></script>
    
    
  </body>
</html>